# microservice-demo
微服务学习 （http://www.itmuch.com/spring-cloud/finchley-2/）


*  2020-11-19
   * microservice-movie-consumer / microservice-movie-provider两个简单的模块，通过HTTP进行通信
* 缺点:
   * 应用没有监控，没有画板，一切指标都没有
   * 地址硬编码问题
   * 负载均衡如何考虑
   * 服务之间没有容错机制
   * 用户认证和授权
   * 如果应用发生故障，怎么迅速找到问题所在
   
* 服务发现的原理
   * 角色： 服务发现组件E / 服务消费者C / 服务提供者P
   * 工作原理： P / C —注册—>E， C从E获取P的地址信息。 然后去调用。 C必须一定时间内发送心跳。

--- 
   
* 2020-11-20
    - 学习微服务的容错机制： Hystrix [hɪst'rɪks] 
* 容错机制出现的原因：
```
    某大型系统中，服务A调用服务B，某个时刻，微服务B突然崩溃了。微服务A中，
依然有大量请求在请求B，如果没有任何措施，微服务A很可能很快就会被拖死——因为在Java中，
一次请求往往对应着一个线程，如果不做任何措施，那意味着微服务A请求B的线程要等
Feign Client/RestTemplate超时才会释放（这个时间一般非常长，长达几十秒），
于是就会有大量的线程被阻塞，而线程又对应着计算资源（CPU/内存），于是乎，
大量的资源被浪费，并且越积越多，最终服务器终于没有资源给微服务A浪费了，
微服务A也挂了
```   
* 常见的容错方式
   * 超时机制： `配置一下超时时间，例如1秒——每次请求在1秒内必须返回，否则到点就把线程掐死，释放资源`
   * 舱壁模式: `M类使用线程池1，N类使用线程池2，彼此的线程池不同，并且为每个类分配的线程池较小。这样不同类属于不同的线程池，一个挂了不影响另一个
   `
   * 断路器（circuitBreaker）：  `一定时间内失败次数/失败率达到一定阈值，就“跳闸”，断路器打开——此时，请求直接返回，而不去调用原本调用的逻辑,
   跳闸一段时间后（例如15秒），断路器会进入半开状态，这是一个瞬间态，此时允许一次请求调用该调的逻辑，如果成功，则断路器关闭，应用正常调用；如果调用依然不成功，断路器继续回到打开状态，过段时间再进入半开状态尝试——通过”跳闸“，应用可以保护自己，而且避免浪费资源；而通过半开的设计，可实现应用的“自我修复“`

* feign整合Hystrix
```
Feign默认已经整合了Hystrix. 但是默认是不启用的，
feign.hystrix.enabled= true, 开启后Feign client会收到Hystrix的保护
```

* 微服务网关
    * 功能： `介于客户端和服务器端之间的中间层，所有的外部请求都会先经过微服务网关,隔离了客户端直接和多个服务器端进行交互。`
    * 优势： 
       * 易于监控。可在微服务网关收集监控数据并将其推送到外部系统进行分析
       * 易于认证。可在微服务网关上进行认证，然后再将请求转发到后端的微服务，而无须在每个微服务中进行认证
       * 减少了客户端与各个微服务之间的交互次数
    * Zuul微服务网关： `核心： 一系列的过滤器`
       * 身份认证与安全：识别每个资源的验证要求，并拒绝那些与要求不符的请求；
       * 审查与监控：在边缘位置追踪有意义的数据和统计结果，从而为我们带来精确的生产视图；
       * 动态路由：动态地将请求路由到不同的后端集群；
       * 压力测试：逐渐增加指向集群的流量，以了解性能；
       * 负载分配：为每一种负载类型分配对应容量，并弃用超出限定值的请求；
       * 静态响应处理：在边缘位置直接建立部分响应，从而避免其转发到内部集群；
       * 多区域弹性：跨越AWS Region进行请求路由，旨在实现ELB（Elastic Load Balancing）使用的多样化；以及让系统的边缘更贴近系统的使用者。
       * 注： 开源版本的Zuul以上功能一个都没有， 参考学习 Spring Cloud Gateway   
       
* Spring Cloud Config
    * config client获取client Server中的配置信息  
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
         